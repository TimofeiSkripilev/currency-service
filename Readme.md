# Сервис истории курсов валют

## Настройка

1.  Установите зависимости:
    npm install

2.  Настройте переменные окружения:
    Создайте файл `.env` в корневой директории и установите следующие переменные:
    PORT=3000 API*HOST=http://localhost DB_HOST=localhost DB_USER=root DB_PASSWORD=ваш*пароль DB*NAME=currency_service JWT_SECRET=ваш*секретный_ключ_JWT REDIS_URL=redis://localhost:6379

3.  Настройте Redis:
    Убедитесь, что Redis установлен и запущен на вашей системе. На Ubuntu вы можете установить его с помощью:
    sudo apt-get install redis-server

    Запустите Redis:
    sudo systemctl start redis-server

4.  Настройте MySQL:
    Убедитесь, что MySQL установлен и запущен на вашей системе.

5.  Выполните миграции базы данных и заполнение начальных данных:
    npm run setup

6.  Запустите сервер разработки:
    npm run dev

7.  Для ручного обновления курсов валют:
    npm run update-rates

## Аутентикация

После установки и запуска проекта вы можете получить доступ к API, используя следующие учетные данные:
- username: admin
- password: admin123

Для получения токена аутентификации отправьте POST-запрос на `/api/auth/login` с указанными учетными данными. Полученный токен можно использовать для доступа к защищенным маршрутам API.

Зарегистрировать нового пользователя - POST-запрос на `/api/auth/register`.

## Использование

1. Текущий курс
    Отправьте GET-запрос на `api/currencies/current/:code` с bearer токеном, где :code - трехбуквенный код валюты (напр. "GBP")

2. История курсов
    Отправьте GET-запрос на `api/currencies/history/:code` с bearer токеном, где :code - трехбуквенный код валюты (напр. "GBP")

3. Список валют
    Отправьте GET-запрос на `api/currencies/list` с bearer токеном

## Запуск с использованием Docker

1. Соберите Docker образ:
   docker-compose build

2. Запустите контейнеры:
   docker-compose up

## Структура проекта

Проект состоит из следующих основных компонентов:

- Конфигурация:

  - `.env`, `.env.example`: Файлы конфигурации переменных окружения.
  - `docker-compose.yml`, `Dockerfile`: Файлы конфигурации Docker.
  - `tsconfig.json`: Файл конфигурации TypeScript.

- База данных:

  - `db/migrations`: Скрипты миграции базы данных.
  - `src/knexfile.ts`: Файл конфигурации Knex.

- Исходный код:

  - `src/app.ts`: Главная точка входа приложения.
  - `src/commands`: Скрипты команд (обновление курсов).
  - `src/config`: Файлы конфигурации для базы данных, окружения и т.д.
  - `src/cron`: Задачи cron для обновления курсов валют.
  - `src/middleware`: Middleware функции Express.
  - `src/models`: Модели базы данных с использованием Objection.js.
  - `src/routes`: Маршруты Express для API эндпоинтов.
  - `src/services`: Основная логика.
  - `src/types`: Определения типов.

- Тестирование:
  - `tests`: Содержит тестовые файлы.

## Зависимости

Проект использует различные зависимости для Express, управления базой данных (Knex, Objection), аутентификации (bcrypt, jsonwebtoken), ограничения скорости запросов, задач cron, Redis, TypeScript и многое другое.

## Дополнительная информация

Проект реализует сервис обмена валют с следующим функционалом:

- Предоставление текущих курсов обмена для выбранных пользователем валют из доступного списка
- Предоставление исторических дневных изменений курсов для выбранной валюты начиная с даты запуска сервиса
- Реализация через HTTP REST API
- Ограничение доступа только для авторизованных пользователей
- Консольная команда для обновления данных в таблице валют
- Использование источника данных о курсах валют: http://www.cbr.ru/scripts/XML_daily.asp

Сервис построен на Node.js 18+ с использованием Express JS и MySQL 8+. Реализованы кэширование, Swagger документация и поддержка Docker.
